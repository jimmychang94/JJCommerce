# Vulnerability Report
This report is to identify weaknesses within our code and what we did to resolve them.

## Vulnerability 1
A4 Insecure Direct Object References  

### Exposure
Several controller actions took in ids but didn't verify whether the user is the correct user to be able to access it.

From exploiting this vulnerability we were able to grab information on what other users had ordered 
(though they wouldn't know who it belonged to).  
They could also delete other people's basket item or edit the quantity of that item.

### Repair
For the order, this was solved by checking the users' Id with what is stored on the specific order.  
If it didn't match then they get redirected to the home page.  
```
var user = await _userManager.GetUserAsync(User);
var order = await _order.GetOrderById(id);
if (order.UserID != user.Id)
{
    return RedirectToAction("Index", "Home");
}
```

For the basket item, this was more complicated since there was no direct way to determine whose item that is.  
In order to solve this problem, the basket associated with that user was pulled 
and if it did not have the same id as the basketID stored on the item then the user gets redirected to the home page.  
```
var user = await _userManager.GetUserAsync(User);
var basket = await _basket.GetBasketById(user);
var basketItem = await _context.GetBasketItemById(id);
if (basket.ID != basketItem.BasketID)
{
    return RedirectToAction("Index", "Home");
}
```

### Resources
1. https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet#ASP.NET_MVC_Guidance  

## Vulnerability 2
A7 Missing function level access control

### Exposure
Our BasketItemController wasn't set so that only members could access it.  
Along with the vulnerabilty from above, un-registered users could delete or edit other people's basket items.  

### Repair
To fix this, I added the following code to the BasketItemController:  
```
[Authorize(Policy = "MemberOnly")]
```

### Resources
1. https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet#ASP.NET_MVC_Guidance  

## Vulnerability 3
Cross Site Scripting (XSS)  

### Exposure  
We implemented nothing to prevent cross site scripting.  

The danger with this is that they would be able to write scripts directly onto the page.  
This is done mostly in JavaScript but can also be done with CSS and IFrames.  
With JavaScript, it is possible to redirect a user to a different page or create a fake login page.  
With CSS, it can change the layout of the page to trick users (ex. they might think this is the login page for another site)  
With IFrames, "pay per view" ads can be injected as well as fake logins.  
With all of these XSS, private data could be stolen.  

### Repair  
Luckily, we don't need to worry about this since .Net Core always encodes user outputs.  
Additionally, the browser Chrome prevents XSS on their end.  

### Resources
1. https://github.com/codefellows/seattle-dotnet-401d4/blob/master/Class38/OWASP.pdf  
2. https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet#ASP.NET_MVC_Guidance  
